---
layout: post
comments: true
title: Getting started with code signing for under $100
excerpt: ! 'I recently documented the steps to "code signing 101": acquiring a trusted
  cert/key pair, the process, and then signing an app.'
wordpress_id: 578
wordpress_url: http://www.jeff.wilcox.name/2010/02/codesigning101/
imported_categories:
- title: c#
  slug: csharp
  autoslug: c#
- title: software-development
  slug: dev
  autoslug: software-development
- title: windows
  slug: windows
  autoslug: windows
- title: infrastructure
  slug: infrastructure
  autoslug: infrastructure
- title: technology
  slug: technology
  autoslug: technology
imported_link_categories: []
tags: []
---
<p><strong>Update 3/15/10: Silverlight 4 supports code signing elevated trust .XAP files</strong></p>

<p>I recently jumped in and acquired an Authenticode code signing certificate &amp; key pair. It’s great being able to sign my .NET executables, installers, and even Visual Studio 2010 extensions.</p>  <p>I’m documenting my efforts here in the hope that others would be able to follow the relatively straightforward process – there’s not much magic other than learning to export and work with the certificate mechanisms inside Windows. But I know a lot of devs see it as a black magic art, and really it’s just about time, money, and some quick learning.</p>  <h4>Which dialog would you click ‘Yes’ on?</h4>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="FakeFirefox" border="0" alt="FakeFirefox" src="http://az414997.vo.msecnd.net/wordpress/2010/02/FakeFirefox.png" width="498" height="295" /></p>  <p>Windows 7 is leaps and bounds ahead of Vista in terms of usability. The improved User Account Control experience is nice. I think that a lot of people are finally becoming more wary of unsigned software, especially installers.</p>  <p>With the net full of stories of mirror servers becoming compromised, or people blinding clicking yes on many dialogs, the assurance of the dialog without the scary orange warning banner is the one I think every software developer would like to offer their customers. It’s the professional thing to do.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="UacFirefox" border="0" alt="UacFirefox" src="http://az414997.vo.msecnd.net/wordpress/2010/02/UacFirefox.png" width="498" height="295" />&#160;</p>  <p>So here we are, from start (no cert) to finish (signing a .NET app). It only took about two days to go through the identity verification process, but the time was well worth it – and the rest is easy given the nice signing tools in Windows and Visual Studio.</p>  <p>We’ll be getting a certificate &amp; private key through a trusted root certificate authority (CA) provider, not test signing or self-signing. If you’ve ever purchased an SSL certificate for your web servers, similar process.</p>  <p>For a list of current program members, see <a href="http://support.microsoft.com/kb/931125">this download</a> on the Microsoft site – there are hundreds of businesses and governments in the program.</p>  <p>Some corporate IT departments will have their own internal CA, so although those companies can sign apps for internal use, using them on machines without that CA cert installed will yield the un-trusted publisher dialog.</p>  <h4>What is Authenticode?</h4>  <p>Authenticode is the name for the code signing system on Windows. There are <a href="http://msdn.microsoft.com/en-us/library/ms537364(VS.85).aspx">many tools from Microsoft</a> that are core to code signing and ship in the Windows SDK.</p>  <p>Code signing certificates have an expiration date, but as long as a timestamp server is used when signing, signed apps can still be used and verified. Certificates can also be revoked if ever compromised.</p>  <p>For good measure, here’s a short Wikipedia page on <a href="http://en.wikipedia.org/wiki/Code_signing">code signing</a>, and the MSDN document “<a href="http://msdn.microsoft.com/en-us/library/ms537361(VS.85).aspx">Introduction to Code Signing</a>”.</p>  <h4>What code signing is not</h4>  <p>Signing is only a way of proving that some person or company is who they say they are. It doesn’t tell you whether there’s a nice person, or in any way validate functionality of an app.</p>  <p>Also, .NET projects have a “Signing” tab, but this is actually a feature called <a href="http://msdn.microsoft.com/en-us/magazine/cc163583.aspx">Strong Naming</a>, and is different. Most commercial software products using .NET will be both strong named, <em>plus</em> be code signed.</p>  <h4>What all can you use your $99/year key for?</h4>    <ul>   <li>Signing Windows executables</li>    <li>.NET programs, class libraries, ClickOnce apps</li>    <li>.MSI installer files</li>    <li>Adobe AIR apps</li>    <li>Java JARs</li>    <li>Microsoft Office/VBA macros</li>    <li>Mozilla objects and extensions</li>    <li>Signing Visual Studio extension packages (.vsix files), although SignTool doesn’t directly support this (no SIP module)</li> </ul>  <p><em>Note that only Verisign offers code signing certificates for Windows device drivers through a special program for kernel-mode code signing.</em></p>  <h4>How does Microsoft do code signing?</h4>  <p>Obviously the Microsoft corporate keys are extremely secure and private. All signing is performed through a set of intricate systems that accept builds, check conditions, scan for viruses, and who knows what else… and eventually provide the signed binaries.</p>  <p>It’s pretty much a black box to us as engineers, but it works for hundreds of thousands of files.</p>  <p>As a dev, I’ve had more than my share of wild Friday nights trying to get code strong named and signed: there’s a big process and it revolves around a lot of people, smart cards, and it eventually works out.</p>  <h2>Step-by-step guide to purchasing a certificate</h2>  <p>Here’s my experience with getting a certificate. Different certification companies may have different processes, but in general you can be sure that you will need to do a lot to provide proof and authenticity of your name/company.</p>  <p>You can purchase a personal certificate (independent developer, professional geek) quicker than a corporate certificate given the different proof requirements.</p>  <p>Since the name/company name is what will be shown in the publisher field, you obviously wouldn’t want to get a personal certificate for company use. Also, be aware that the address you provide to a signing company will be embedded inside the certificate.</p>  <p>I purchased my code signing cert through <a href="https://secure.ksoftware.net/code_signing.html">K Software</a>, which is an official reseller of <a href="http://www.comodo.com/">Comodo</a> certificates, a popular Level 2 CA whose certificates are part of the root CA program on computers everywhere. The certificate costs $99 per year. I’ve heard of other companies sometimes offering specials as low as $65 a year, and others such as Verisign asking $499 a year.</p>  <p>Since there is some pain in the process (producing copious amounts of evidence) and waiting for that to be validated, you may want to consider purchasing a multi-year certificate and skip having to renew yearly.</p>  <p>You must use Windows and either Internet Explorer or Firefox to make the initial request. After the entire process is complete and the certificate is issued (days later), you will need to use the same computer and browser to complete the process. You will then export the certificate and private key to a file so you can store it safely somewhere.</p>  <h4>What proof will be required</h4>  <p>This is a partial list, the authentication process may require other documents. Most verification can be done through fax, mail, or even email.</p>  <p>If you’ve ever purchased an SSL certificate, it’s almost the same exact process.</p>  <ul>   <li>Your own domain name:</li>    </ul><ul>     <li>The domain’s WHOIS records must match the information you provide in your order.</li>      <li>If you use Private Registration services, you’ll need proof from the private registration company that you own the domain and your address matches. This can be a pain.</li>   </ul>    <li>Corporate entities:</li>    <ul>     <li>Articles of Incorporation</li>      <li>Business License</li>      <li>Other documentation such as DUNS details</li>   </ul>    <li>Individuals:</li>    <ul>     <li>Driver’s license or passport</li>      <li>Recent utility statements with matching data</li>      <li>Phone statement with matching information, name, and phone number where final phone verification will be performed</li>   </ul>   <p>This information will be asked for after you order and pay for the service. It is performed by the CA (Comodo in my case), <em>not</em> by the company or reseller you buy the service from.</p>  <p>For the remainder of this section, everything will be specific to Comodo. I found them helpful, quick and responsive, and professional, so I would definitely recommend their service. It is a great value when purchased through a reseller.</p>  <h4>Step 1: Register with the CA to track your validation tickets and receive support</h4>  <p>You’ll need to do this with an email address at your domain name. You register with the same email you’ll use in the next step.</p>  <p>If you don’t usually receive mail at your domain, you should be able to easily setup mail forwarding to your normal mail address. On a Windows server, <a href="http://www.smartertools.com/SmarterMail/Free-Windows-Mail-Server.aspx">SmarterMail Free</a> sets up in minutes and is great for this.</p>  <p>Simply create an account at Comodo Support for this: <a title="https://support.comodo.com/index.php?_m=core&amp;_a=register" href="https://support.comodo.com/index.php?_m=core&amp;_a=register">https://support.comodo.com/index.php?_m=core&amp;_a=register</a></p>  <h4>Step 2: Submit basic data and purchase</h4>  <p>Start at the K Software site, which is a reseller of Comodo’s: <a title="https://secure.ksoftware.net/code_signing.html" href="https://secure.ksoftware.net/code_signing.html">https://secure.ksoftware.net/code_signing.html</a></p>  <p>Current prices are $99 US for one year, $198 for 2 years, and so on.</p>  <p>After navigating to the page, click Buy Now. Internet Explorer will pop up a message that the site is attempting to perform a digital certificate operation. Click Yes.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="WebAccessConfirmation" border="0" alt="WebAccessConfirmation" src="http://az414997.vo.msecnd.net/wordpress/2010/02/WebAccessConfirmation.png" width="528" height="291" /> </p>  <p>On the order form page, you will submit your details, including address, email, etc. The email address needs to be an email address on your domain name that can be verified, <em>not</em> a Hotmail or Google Mail address. Note that this information will be embedded inside the final issued certificate.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="OrderForm" border="0" alt="OrderForm" src="http://az414997.vo.msecnd.net/wordpress/2010/02/OrderForm.png" width="685" height="419" /> </p>  <p>Important values at the end of the page:</p>  <ul>   <li>CSP should be Microsoft Enhanced Cryptographic Provider v1.0 (the default)</li>    <li>Key size: 2048 is fine for most people</li>    <li>Exportable: definitely – if you don’t check this, you can’t get a PKCS 12 (.pfx on Windows) file to use for signing, and would have to do all signing on that machine</li>    <li>User protected: Leave this unchecked</li> </ul>  <p>After clicking Submit Order, you’ll go to a payment page. I used PayPal and was done in seconds.</p>  <h4>Step Three: You’ll be contacted</h4>  <p>At this point you’re done with the K Software order. You will be contacted via e-mail from Comodo, and they’ll step you through what verification they need at that time, and how to submit it.</p>  <p>In my case I had to go through several rounds of verification, including sending a recent phone bill.</p>  <p>I ran into some hiccups because the domain name I used for the e-mail address, though owned by me, is hard to prove: my WHOIS data all says ‘Domains By Proxy’, which is the provider of private registration services for GoDaddy. I had to find a way to provide proof that I own the domain.</p>  <p>The final verification step is when they eventually call your phone number. After that call, they’ll issue the certificate approval, and you’ll receive a final e-mail about 20 minutes later to go pick up the certs.</p>  <p>This step took me 1.5 business days including waiting time.</p>  <h4>Step Four: Pick up your key</h4>  <p>On the same computer you started the operation on, and same browser, click on the link provided in the e-mail Comodo sent when the key was ready.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="KSoftwarePickup" border="0" alt="KSoftwarePickup" src="http://az414997.vo.msecnd.net/wordpress/2010/02/KSoftwarePickup.png" width="685" height="531" /> </p>  <p>On this page, you’ll again receive a notification about a certificate operation. That’s fine. At this point you now have the key stored in your browser certificate system.</p>  <h4>Step Five: Export your key</h4>  <p>This step is for Internet Explorer users. If you’re using Mozilla Firefox, <a href="http://blog.ksoftware.net/2009/10/exporting-your-code-signing-certificate-to-a-pfx-file-from-firefox/">here’s some other instructions</a>.</p>  <p></p>  <p></p>  <p>In IE now, click Tools | Internet Options. Click on the Content tab, and then the Certificates button:</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="InternetOptions" border="0" alt="InternetOptions" src="http://az414997.vo.msecnd.net/wordpress/2010/02/InternetOptions.png" width="455" height="573" /> </p>  <p>Within the Personal (first) tab of the Certificates dialog, click on the new certificate issued by UTN-USERFirst-Object (this is one of the many Comodo level 2 CAs in the Windows root CA program):</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Certificates" border="0" alt="Certificates" src="http://az414997.vo.msecnd.net/wordpress/2010/02/Certificates.png" width="551" height="509" /> </p>  <p>Then click ‘Export…’. In the Certificate Export Wizard, read the useless text and click Next.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="ExportWizardStart" border="0" alt="ExportWizardStart" src="http://az414997.vo.msecnd.net/wordpress/2010/02/ExportWizardStart.png" width="545" height="498" /> </p>  <p>Select the option ‘Yes’ for exporting the private key along with the certificate.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="ExportPrivateKeyPlease" border="0" alt="ExportPrivateKeyPlease" src="http://az414997.vo.msecnd.net/wordpress/2010/02/ExportPrivateKeyPlease.png" width="545" height="498" /> </p>  <p>Next, you pick the file format. Only PFX/PKCS #12 should be available. I checked both ‘Include all certificates in the certification path if possible’ and ‘Export all extended properties’, though to be honest I haven’t a clue whether this is needed.</p>  <p>I wouldn’t recommend clicking the delete private key option, I like knowing that on this particular machine I can still re-export the cert as needed in the future.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="ExportTypeAndOptions" border="0" alt="ExportTypeAndOptions" src="http://az414997.vo.msecnd.net/wordpress/2010/02/ExportTypeAndOptions.png" width="545" height="498" /> </p>  <p>Now, come up with a password to protect the file. You will need to use this password when using tools such as SignTool.exe, or setting up an automated code signing process of your own.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="ExportKeyPasswordDialog" border="0" alt="ExportKeyPasswordDialog" src="http://az414997.vo.msecnd.net/wordpress/2010/02/ExportKeyPasswordDialog.png" width="545" height="498" /> </p>  <p>Finally, pick where you want your .PFX file stored.</p>  <h4>Step Six: Protect your key</h4>  <p>Although code signing certificates have a mechanism through the CA to revoke keys, <strong>you do not ever want to have to do this.</strong></p>  <p>Take precautions. It is your duty to protect your key. Many people find ways to store this information through smart card or other physical security mechanisms.</p>  <p>As an individual, it’s pretty easy for me: Only I know the password, I have the file securely stored, and I don’t need to worry about sharing it with others.</p>  <p>Business entities and groups will have more trouble coming up with the appropriate processes and systems for this. Ideally some sort of automated system should be used to perform the code signing, with alternative authentication; providing the key file and a password is not the best method.</p>  <h4>Import Wizard Note</h4>  <p>To manually sign on another machine, you’ll want to double-click on the .pfx file. An import wizard will open up that will allow you to install the cert and private key on your machine.</p>  <p>For manual signing you typically select from your private certificate store on the machine, instead of using the .pfx file directly. For automated signing, you probably will use the .pfx.</p>  <h2>How to sign your apps and libraries</h2>  <p>Now the fun part. Armed with your new code signing certificate and private key, you’re ready to go SignTool.exe’ing.</p>  <p>SignTool is included with the Windows 6.0 and 7.0A SDKs, and you’ll have it in your path if you have Visual Studio 2008 or 2010 installed and are using the associated Visual Studio Command Prompt.</p>  <p>You can create scripts to sign quickly using command line parameters, or even write .NET apps using types in the System.Security.Cryptography.X509Certificates namespace.</p>  <p>It’s easiest to get started by manually signing, using the Digital Signature Wizard. From a Visual Studio 2008 Command Prompt, for instance, run:</p>  <blockquote>   <p>signtool.exe signwizard</p> </blockquote>  <p>This will popup the wizard that will walk you through.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard" border="0" alt="Digital Signature Wizard" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard.png" width="545" height="431" /></p>  <p>Select the file you want to sign:</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (3)" border="0" alt="Digital Signature Wizard (3)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard3.png" width="545" height="431" /></p>  <p>The ‘Typical’ option will let you pick from the certificate store on your machine. You don’t actually select the previously-exported .PFX file when manually signing.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (4)" border="0" alt="Digital Signature Wizard (4)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard4.png" width="545" height="431" /></p>  <p>Here I click ‘Select from Store…’:</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (5)" border="0" alt="Digital Signature Wizard (5)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard5.png" width="545" height="431" /></p>  <p>Which pops up a Windows dialog listing available code signing certificates.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="SelectACertificate" border="0" alt="SelectACertificate" src="http://az414997.vo.msecnd.net/wordpress/2010/02/SelectACertificate.png" width="471" height="266" /> </p>  <p>Here I can verify the goods:</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (6)" border="0" alt="Digital Signature Wizard (6)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard6.png" width="545" height="431" /></p>  <p>On the next wizard page, you can optionally offer more information here as appropriate.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (7)" border="0" alt="Digital Signature Wizard (7)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard7.png" width="545" height="431" /> </p>  <p>The last optional, but highly recommended step, is to use the timestamp server provided by the CA. This is a service that authenticates when the data (your app) was signed.</p>  <p>This means that your app will continue to be valid, even after the certificate expires, as long as the cert is not revoked.</p>  <p>For Comodo, their timestamping server is: <a title="http://timestamp.comodoca.com/authenticode" href="http://timestamp.comodoca.com/authenticode">http://timestamp.comodoca.com/authenticode</a></p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (8)" border="0" alt="Digital Signature Wizard (8)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard8.png" width="545" height="431" /></p>  <p>Click Next and you’ll see the summary of what signing is to take place.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (9)" border="0" alt="Digital Signature Wizard (9)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard9.png" width="545" height="431" /></p>  <p>After clicking Finish, the dialog will go away, and pretty soon you should receive a success/failure message.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Digital Signature Wizard (10)" border="0" alt="Digital Signature Wizard (10)" src="http://az414997.vo.msecnd.net/wordpress/2010/02/DigitalSignatureWizard10.png" width="440" height="203" /></p>  <h4>CodeSign.exe Parameters</h4>  <p>You can also code sign in scripts and the command line using arguments. For instance, here’s a sample made-up signing argument list. You can specify any number of files to sign as the final arguments.</p>  <blockquote>   <p>signtool.exe sign /f PathToKeysAndCert.Pfx /p “MySuperSecretPasswordToUseThePfxFile” /v /t http://timestamp.comodoca.com/authenticode “C:\MyFileToSign.exe”</p> </blockquote>  <p></p>  <p></p>  <p>For all the parameters, type ‘signtool sign /?’</p>  <h4>That’s it!</h4>  <p>You can use a variety of tools to check that the signing works fine, including just examining the file in the Windows explorer.</p>  <p>Authenticode-signed executables, MSIs and libraries will have a ‘Digital Signatures’ tab in the properties window (though not irregular file types, such as Adobe AIR files).</p>  <p>Here’s the .exe I signed:</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="FileProperties" border="0" alt="FileProperties" src="http://az414997.vo.msecnd.net/wordpress/2010/02/FileProperties.png" width="451" height="565" />&#160;&#160;&#160; </p>  <p>And that’s it! <strong>Ship it!</strong></p>  <p>Your customers will have that extra level of confidence when using your application. At some point, the more more professional software developers and software companies code sign, the more likely customers will be able to make proper security decisions about their computers… and the real benefit of the crisp user account control user interface comes to light.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="VerifiedPublisher" border="0" alt="VerifiedPublisher" src="http://az414997.vo.msecnd.net/wordpress/2010/02/VerifiedPublisher.png" width="498" height="295" /> </p>  <p>Hope this helps. Let me know how your experiences with code signing go.</p>
